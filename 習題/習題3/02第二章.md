## 第二章
組合語言（Assembly Language）是一種***低階***程式語言，用來***將人類易於理解的指令轉譯成計算機可執行的機器碼***。組合語言的基本單位是***指令（Instruction）***，每一條指令對應著計算機上的一個機器碼指令，可以執行某個特定的操作，例如加法、減法、載入、儲存等。

組合語言的語法與機器指令非常相似，因此很難閱讀和維護。通常會使用***符號或名稱來代表不同的機器指令***，讓程式更容易理解和維護。另外，組合語言也會使用***記憶體地址***來操作資料，因此需要對電腦硬體的記憶體結構有相當的了解。

#### 要使用組合語言來進行系統程式的開發，需要掌握以下幾個基本步驟：

1. 編寫組合語言程式：使用組合語言編寫程式碼，透過指令控制CPU執行特定的操作。

2. 編譯組合語言程式：使用組合語言編譯器（Assembler）將組合語言程式碼轉換成機器碼或目標碼。這些機器碼或目標碼可以直接執行於電腦上，但是通常需要進一步進行連結（Linking）或載入（Loading）等操作。

3. 連結程式庫：組合語言程式中可能需要使用一些底層函式庫（如操作系統API），因此需要連結相關的程式庫，以便在執行時能夠正確地呼叫這些函式庫。

4. 載入程式：將編譯後的程式載入到電腦的記憶體中，讓CPU能夠執行。

5. 測試和調試：測試和調試是程式開發中非常重要的步驟，可以透過各種工具來進行。組合語言程式中常會使用一些除錯器（debugger）或模擬器（simulator）等工具來幫助開發者進行調試。這些工具可以用來監視程式的執行狀態、查看記憶體中的數值、設定斷點等等。

在開發系統程式時，組合語言通常用來撰寫***底層的系統***操作程式，例如驅動程式、作業系統核心等等。這些程式需要直接操作硬體，因此使用組合語言能夠更好地控制和優化執行效率。然而，組合語言也具有很高的複雜度和易錯性，需要開發者有相當程度的技術水平和經驗才能夠開發出高品質的程式。
<br/>

#### 組合語言的基礎語法相對於高階語言比較簡單，以下是一些常見的組合語言基礎語法：

1. 標籤（Label）：用來標示指令或數據的位置，通常是以冒號（:）結尾的符號。
    ```
    mylabel:
    ```

2. 操作碼（Opcode）：指令的操作部分，描述該指令要執行的操作。
    ```
    mov eax, 1  ; 將數字1存入eax寄存器中
    ```
3. 運算元（Operand）：指令所要操作的數據或地址。
    ```
    mov ecx, [ebx] ; 將ebx指向的內容存入ecx寄存器中
    ```
4. 寄存器（Register）：用來存儲數據的硬體元件，組合語言中常用的寄存器包括通用寄存器、段寄存器、標誌寄存器等。
    ```
    mov eax, ebx ; 將ebx的值存入eax寄存器中
    ```
5. 操作數（Immediate）：指令中直接指定的數值，用來對寄存器進行初始化、計算等操作。
    ```
    mov eax, 0x1234 ; 將0x1234存入eax寄存器中
    ```
6. 記憶體地址（Memory Address）：指向記憶體中特定位置的指標，可以進行讀取或寫入操作。
    ```
    mov eax, [0x12345678] ; 將0x12345678地址處的內容存入eax寄存器中
    ```
7. 註解（Comment）：用來在代碼中添加說明或解釋的語句。
    ```
    ; This is a comment
    mov eax, 1 ; This is also a comment
    ```
<br/>

#### 下面是一個簡單的組合語言代碼示例：
```
section .data
    msg db 'Hello, world!',0

section .text
    global _start

_start:
    ; write message to stdout
    mov eax, 4 ; system call number for write
    mov ebx, 1 ; file descriptor for stdout
    mov ecx, msg ; message to write
    mov edx, 13 ; message length
    int 0x80 ; invoke system call

    ; exit program
    mov eax, 1 ; system call number for exit
    xor ebx, ebx ; return value (0)
    int 0x80 ; invoke system call
```
上述代碼定義了一個名為msg的字符串變數，然後使用系統調用（system call）的方式向標準輸出（stdout）寫入該字符串，最後退出程序。下面是這段代碼的說明：

第一行定義了一個數據段（.data），並在其中定義了一個名為msg的字串變數。db代表定義byte數據，0表示字串結尾。

第四行定義了一個代表程序起點的標籤（_start），表示程序的執行從這裡開始。

接下來的幾行是系統調用的代碼。mov指令用來將值載入到寄存器中，int 0x80用來觸發系統調用（system call）。在這裡，第一個系統調用用來向標準輸出寫入msg變數中的字符串，第二個系統調用用來退出程序。

這只是一個簡單的例子，實際的組合語言代碼往往更加複雜。開發者需要熟悉各種指令和系統調用，了解計算機硬體的結構和運作原理，以及如何進行記憶體管理和錯誤處理等方面的知識，才能開發出高效、穩定的系統程式。